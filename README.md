# CCMORPH The Coastal Cliffs Morphology Analysis Toolbox

Projekt został stworzony z myślą o umożliwieniu analizy wybrzeży morskich na podstawie ...[Paweł T.]

### requirements
The calculation requires installation of the following, among others: pandas, geopandas, scipy, gdal, rtree

apt get install python3-rtree



    6  sudo apt install gdal-bin
    7  sudo apt install libgdal-dev
    8  gdalinfo --version
   95  gdalinfo --version
  228  pip install --upgrade --force-reinstall gdal
  229  gdalinfo --version
  230  pip install --upgrade --force-reinstall gdal==3.4.1

python3 -m venv env
source env/bin/activate

check gdal version installed in system (gdalinfo --version)

edit requirements.txt - change line GDAL=...
pip install -r requirements.txt



<!-- ............................................................................................................................ -->
## generator-py

The program is used to generate elevation profiles based on a given coastal DEM file (geotiff), a specified shoreline (shp line) and a trimming area (shp polygon). Basic parameters such as input and output data paths or transect parameters (lengths and spacing) can be set in the config.json file.

The final results and as well as all intermediate results are saved. Those that can be used, for example, by shaper-py, analyzer-py or click-the-coast-js in the form of separate files (separate directory structure), part in the GeoPackage database.

What does the program do?
1. validates input data
2. creates or cleans directories for output and intermediate data
3. initializes the database
4. generates transects based on shoreline (data/input/coast)
5. creates buffers around transects and cuts for each buffer a DEM based on the overall image (data/input/dem)
6. generates elevation profiles from transects and trimmed DEM models
7. trims the profiles to the specified area (data/input/crop) and saves them (data/output/profiles/cropped)
8. saves data for profile visualization in click-the-coast-js web application (data/output/web/geotif, data/output/web/geojdon, data/output/web/names)

### configuration

The default configuration of the program can be changed by editing the generator-py/config.json file. Among other things, we can specify:
- directory paths for input data,
- directory paths for output data,
- the path to the database,
- parameters of generated transects,
- parameters of layers in the database (names, crs, ...), etc.

<!-- ............................................................................................................................ -->
## shaper-py

The program allows you to automatically determine the base and peak of the profile using one of the two available methods (1. ..., 2. ... [Paweł T.]). Basic parameters, such as paths or method type, can be set in the config.json file.

What does the program do?
1. reads the trimmed profiles generated by generator-py (data/output/profiles/cropped)
2. finds the base and peak on the profiles (choose one of the methods described in the article)
3. saves shaper.csv results to two directories (data/output/results and data/output/web/results)
4. optionally saves calculation details for each profile for method 1 (data/output/debug) 

### configuration

- paths to the input data,
- paths to output data,
- the selected method of determining points (1 or 2),
- optional profile smoothing parameters,
- optional debug parameters,
etc.

<!-- ............................................................................................................................ -->
## click-the-coast-js

A web application that visualizes elevation profiles in which the base and peak could not be automatically determined. It allows you to manually indicate both parameters of the profile. The profile is displayed as a line on the map (top view) and an intersection (side view). Basic parameters, such as paths, can be set in scripts/config.js file).

What does the program do?
1. reads profile names generated by generator-py (data/output/web/names/names.json)
2. reads trimmed profiles (output/web/geojson) and BBOXes (data/output/web/geotiff)
3. reads information about profiles whose base and peak have already been automatically determined by shaper-py (data/output/results/shaper.csv)
4. visualizes profiles without designated bases and peaks and allows you to manually indicate them
5. saves the results to a csv file (data/output/web/results/manual.csv)

**NOTE**: Click-the-coast-js is a web application and requires PHP, among other things, to work. Since it can only refer to the directory in which it is placed, so the necessary data must be copied to and from it. The easiest way is to move a piece of the data/output/web directory hierarchy to the application directory. Remember to cpoy the later received manual.csv file to the original results directory!

### configuration

The default configuration can be changed by editing the click-the-coast-js/scripts/config.js file. Among other things, you can set in it:
- path to the directory with profiles,
- path to the directory with bbox files,
- path to the file with profile names,
- map parameters,
etc.

<!-- ............................................................................................................................ -->
## analyzer-py

The program collects information about the bases and peaks of profiles (generated automatically and indicated manually) and calculates such properties as distance, slope and volume for them. Parameters to be set in the config.json file.

What does the program do?
1. reads the trimmed profiles generated by generator-py (data/output/profiles/cropped)
2. reads information about profiles whose base and peak have already been automatically determined by shaper-py (data/output/web/results/shaper.csv)
3. reads the results of click-the-coast-js, i.e. bases and peaks determined manually (data/output/web/results/manual.csv - remember to copy this file after using click-the-coast-js from the web application's data directory)
4. determines profile parameters (distance, slope, volume) for designated bases and peaks
5. saves the results in a csv file (data/output/finall)
6. saves lists of peaks and bases separately to shp files (data/output/finall)

### configuration

- paths to the input data,
- paths to output data,
- format of csv file with results from shaper-py,
etc.